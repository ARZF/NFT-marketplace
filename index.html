<!DOCTYPE html>
<html lang="fa" dir="rtl">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>بازارچه توکن‌های غیرمثلی (NFT) پایتون</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/ethers@6.11.1/dist/ethers.umd.min.js"></script>
    <style>
        /* OpenSea-like hover sidebar */
        .os-sidebar {
            position: fixed;
            /* تغییر از left به right */
            right: 16px;
            top: 96px;
            bottom: 40px;
            width: 64px;
            background: rgba(15, 23, 36, 0.8);
            border: 1px solid rgba(148, 163, 184, 0.06);
            border-radius: 12px;
            padding: 6px;
            display: flex;
            flex-direction: column;
            gap: 6px;
            overflow: hidden;
            z-index: 60;
            transition: width 180ms ease;
            backdrop-filter: blur(6px);
        }

        .os-sidebar:hover {
            width: 220px;
        }

        .os-item {
            display: flex;
            /* برای RTL، جهت آیتم‌ها باید عکس شود */
            flex-direction: row-reverse;
            align-items: center;
            gap: 12px;
            padding: 10px;
            border-radius: 10px;
            color: #cbd5e1;
        }

        .os-item svg {
            flex: 0 0 20px;
        }

        .os-label {
            white-space: nowrap;
            overflow: hidden;
            opacity: 0;
            /* تغییر برای حرکت به راست (در RTL) */
            transform: translateX(6px);
            transition: opacity 140ms ease, transform 140ms ease;
        }

        .os-sidebar:hover .os-label {
            opacity: 1;
            transform: translateX(0);
        }

        .os-item:hover {
            background: rgba(255, 255, 255, 0.03);
            color: #fff
        }

        @media (max-width:900px) {
            .os-sidebar {
                display: none
            }
        }
    </style>
</head>

<body class="bg-slate-950 text-white min-h-screen font-sans">
    <nav class="os-sidebar" aria-label="Main navigation">
        <a href="#" class="os-item" id="navExplore">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none"
                stroke="currentColor">
                <path d="M21 10v8a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h8" stroke-width="1.5"
                    stroke-linecap="round" stroke-linejoin="round" />
            </svg>
            <span class="os-label font-medium">کاوش</span>
        </a>
        <a href="/mint_new_nft" class="os-item" id="navMint">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none"
                stroke="currentColor">
                <path d="M12 5v14M5 12h14" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
            <span class="os-label font-medium">ضرب NFT</span>
        </a>
        <a href="#" class="os-item" id="navCollections">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none"
                stroke="currentColor">
                <rect x="3" y="3" width="7" height="7" stroke-width="1.5" rx="1" />
                <rect x="14" y="3" width="7" height="7" stroke-width="1.5" rx="1" />
                <rect x="14" y="14" width="7" height="7" stroke-width="1.5" rx="1" />
            </svg>
            <span class="os-label font-medium">مجموعه‌ها</span>
        </a>
        <a href="#" class="os-item" id="navActivity">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none"
                stroke="currentColor">
                <path d="M3 12h3l3 8 4-16 3 8h4" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
            <span class="os-label font-medium">فعالیت‌ها</span>
        </a>
        <a href="#" class="os-item" id="navFavorites">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none"
                stroke="currentColor">
                <path
                    d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 1 0-7.78 7.78L12 21.23l8.84-8.84a5.5 5.5 0 0 0 0-7.78z"
                    stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
            <span class="os-label font-medium">علاقه‌مندی‌ها</span>
        </a>
        <a href="#" class="os-item mt-auto" id="navSettings">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none"
                stroke="currentColor">
                <path d="M12 15.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7z" stroke-width="1.5" stroke-linecap="round"
                    stroke-linejoin="round" />
                <path
                    d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09a1.65 1.65 0 0 0 1.51-1 1.65 1.65 0 0 0-.33-1.82L4.21 3.4A2 2 0 0 1 7.04.58l.06.06c.5.5 1.2.71 1.82.33.57-.35 1.24-.53 1.91-.53h.1c.67 0 1.34.18 1.91.53.62.38 1.32.17 1.82-.33l.06-.06A2 2 0 0 1 19.79 3.4l-.06.06c-.5.5-.71 1.2-.33 1.82.35.57.53 1.24.53 1.91v.1c0 .67-.18 1.34-.53 1.91-.38.62-.17 1.32.33 1.82l.06.06c.89.89.89 2.34 0 3.23z"
                    stroke-width="0.8" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
            <span class="os-label font-medium">تنظیمات</span>
        </a>
    </nav>
    <header class="bg-slate-900 border-b border-slate-800">
        <div class="max-w-6xl mx-auto px-6 py-4 flex items-center justify-between">
            <div class="flex items-center gap-4 flex-row-reverse">
                <div
                    class="w-10 h-10 rounded-lg bg-gradient-to-br from-cyan-400 to-violet-600 flex items-center justify-center font-bold text-slate-900">
                    N</div>
                <div class="text-right">
                    <div class="text-lg font-semibold">بازارچه NFT</div>
                    <div class="text-xs text-slate-400">کشف و تجارت آثار دیجیتال</div>
                </div>
            </div>

            <div class="flex items-center gap-4">
                <div
                    class="hidden md:flex items-center bg-slate-800/60 border border-slate-700 rounded-lg px-3 py-2 gap-3">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" class="text-slate-400">
                        <path d="M21 21l-4.35-4.35" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"
                            stroke-linejoin="round"></path>
                        <circle cx="11" cy="11" r="6" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"
                            stroke-linejoin="round"></circle>
                    </svg>
                    <input id="globalSearch" placeholder="جستجوی آیتم‌ها، مجموعه‌ها، حساب‌ها"
                        class="bg-transparent outline-none text-slate-300 placeholder:text-slate-500 w-64" />
                </div>
                <a href="#"
                    class="hidden sm:inline-block px-4 py-2 rounded-lg text-sm font-semibold text-slate-200 bg-slate-800 border border-slate-700">کاوش</a>
                <a href="#"
                    class="px-4 py-2 rounded-lg text-sm font-semibold text-white bg-emerald-500 hover:bg-emerald-400">ایجاد</a>

                <div class="relative">
                    <button id="walletButton"
                        class="ml-2 px-4 py-2 rounded-md bg-slate-100 text-slate-900 font-semibold hover:bg-white transition">اتصال
                        کیف پول</button>
                    <div id="walletMenu"
                        class="hidden absolute right-0 mt-2 w-56 bg-slate-800 border border-slate-700 rounded-lg p-2 z-50">
                        <button id="viewOwnedBtn" class="w-full text-right px-3 py-2 rounded hover:bg-slate-700">مشاهده
                            NFTهای من</button>
                        <button id="showAllBtn" class="w-full text-right px-3 py-2 rounded hover:bg-slate-700">نمایش
                            همه</button>
                        <div class="border-t border-slate-700 my-1"></div>
                        <button id="disconnectBtn"
                            class="w-full text-right px-3 py-2 rounded text-red-400 hover:bg-slate-700">قطع
                            اتصال</button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-6xl mx-auto px-6 py-12 space-y-16">
        <section class="bg-gradient-to-b from-slate-900/60 to-transparent rounded-3xl p-8 border border-slate-800">
            <div class="flex flex-col md:flex-row-reverse items-start md:items-center justify-between gap-6">
                <div class="max-w-2xl text-right">
                    <h1 class="text-4xl md:text-5xl font-bold">NFTهای خارق‌العاده را کشف، جمع‌آوری و بفروشید</h1>
                    <p class="text-slate-400 mt-3">مجموعه‌های پرطرفدار را کاوش کنید، آثار هنری دیجیتال کمیاب را کشف
                        کنید و به
                        مزایده‌ها بپیوندید. پشتیبانی داخلی از کیف پول برای خریدهای سریع.</p>
                    <div class="flex gap-3 mt-5 justify-end">
                        <a href="#" class="px-5 py-3 rounded-lg bg-emerald-500 text-slate-900 font-semibold">کاوش</a>
                        <a href="#mintForm"
                            class="px-5 py-3 rounded-lg border border-slate-700 text-slate-200">ایجاد</a>
                    </div>
                </div>
                <div class="w-full md:w-96 grid grid-cols-3 gap-3">
                    <img class="rounded-xl col-span-2 h-40 object-cover" src="https://picsum.photos/seed/hero1/600/400"
                        alt="hero">
                    <img class="rounded-xl h-40 object-cover" src="https://picsum.photos/seed/hero2/300/400" alt="hero">
                </div>
            </div>
        </section>
        <section>
            <div class="flex items-end justify-between gap-4 flex-wrap mb-8 flex-row-reverse">
                <div class="text-right">
                    <p class="text-sm uppercase text-slate-400 tracking-wide">
                        موجودی بازارچه
                    </p>
                    <h2 class="text-3xl font-semibold text-white">
                        آثار فعال برای فروش
                    </h2>
                </div>
            </div>
            <div id="listingsGrid" class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
            </div>
            <div id="emptyState" class="hidden text-center text-slate-500 mt-16">
                هیچ NFT فعالی برای فروش پیدا نشد.
            </div>
        </section>
    </main>

    <div id="ownedNFTsModal" class="hidden fixed inset-0 bg-black/80 z-40 overflow-y-auto">
        <div class="max-w-6xl mx-auto px-6 py-12">
            <div class="flex items-center justify-between mb-8 flex-row-reverse">
                <h1 class="text-3xl font-bold text-white">NFTهای شما</h1>
                <button id="closeOwnedModal" class="text-slate-400 hover:text-white text-2xl">✕</button>
            </div>
            <div id="ownedNFTsGrid" class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
            </div>
            <div id="ownedEmptyState" class="hidden text-center text-slate-500 mt-16">
                شما هنوز NFT‌ای ندارید.
            </div>
        </div>
    </div>

    <template id="listingCardTemplate">
        <article class="bg-slate-900 border border-slate-800 rounded-2xl p-5 flex flex-col gap-4 text-right">
            <div class="h-48 rounded-xl bg-cover bg-center bg-slate-800" data-field="image"></div>
            <div>
                <h3 class="text-xl font-semibold text-white" data-field="title"></h3>
                <p class="text-slate-400 text-sm break-words" data-field="address"></p>
            </div>
            <div class="flex items-center justify-between flex-row-reverse">
                <div>
                    <p class="text-xs uppercase tracking-wide text-slate-400">
                        قیمت
                    </p>
                    <p class="text-2xl font-bold text-emerald-400" data-field="price"></p>
                </div>
                <button
                    class="buy-btn px-4 py-2 rounded-lg font-semibold text-slate-900 bg-emerald-400 hover:bg-emerald-300 transition disabled:opacity-50 disabled:cursor-not-allowed"
                    type="button">
                    خرید NFT
                </button>
            </div>
            <p class="text-xs text-slate-500" data-field="seller"></p>
        </article>
    </template>

    <script>
        //... کد جاوا اسکریپت بدون تغییر در منطق
        // تغییرات متون داخل جاوا اسکریپت:

        // ...
        async function connectWallet() {
            if (!window.ethereum) {
                alert("MetaMask (یا یک کیف پول EIP-1193 دیگر) مورد نیاز است.");
                return;
            }
            try {
                // ...
                walletButton.textContent = shortenAddress(userAddress);
                // ...
                // hide menu on connect (will toggle when clicking)
                walletMenu?.classList.add('hidden');
            } catch (error) {
                console.error("Wallet connection failed", error);
                alert(`اتصال کیف پول ناموفق بود: ${error.message}`);
            }
        }

        // ...
        function disconnectWallet() {
            // ...
            walletButton.textContent = 'اتصال کیف پول';
            // ...
        }

        function viewOwnedNFTs() {
            if (!userAddress) {
                alert('لطفاً ابتدا کیف پول خود را متصل کنید.');
                return;
            }
            // ...
        }

        function renderOwnedNFTsModal(listings) {
            //...
            if (!listings.length) {
                ownedEmptyState.textContent = "شما هنوز NFT‌ای ندارید."; // ترجمه متن خالی
                ownedEmptyState.classList.remove('hidden');
                // ...
            } else {
                // ...
            }
            // ...
        }

        async function fetchListings() {
            try {
                // ...
            } catch (error) {
                console.error("Failed to fetch listings", error);
                emptyState.textContent = "قادر به بارگیری NFT‌ها نیست. بک‌اند را بررسی کنید."; // ترجمه متن خطا
                emptyState.classList.remove("hidden");
            }
        }

        function renderListings(listings) {
            // ...
            if (!listings.length) {
                emptyState.textContent = "هیچ NFT فعالی برای فروش پیدا نشد."; // ترجمه متن خالی
                emptyState.classList.remove("hidden");
                return;
            }
            // ...
            listings.forEach((listing) => {
                // ...
                const buyButton = template.querySelector(".buy-btn");
                buyButton.textContent = "خرید NFT"; // ترجمه
                // ...
            });
        }

        async function handleBuy(listing, button) {
            try {
                // ...
                button.textContent = "تأیید در کیف پول..."; // ترجمه
                // ...
                button.textContent = "در انتظار بلاک..."; // ترجمه
                await tx.wait();
                button.textContent = "فروخته شد"; // ترجمه
                // ...
                alert(`موفقیت‌آمیز بود! هش تراکنش: ${tx.hash}`); // ترجمه
            } catch (error) {
                console.error("Transaction failed", error);
                alert(error?.data?.message ?? error.message ?? "تراکنش رد شد"); // ترجمه
                button.disabled = false;
                button.textContent = "خرید NFT"; // ترجمه
            }
        }

        async function handleMintForm(event) {
            event.preventDefault();
            if (!mintImageInput?.files?.length) {
                setMintStatus("لطفاً یک فایل تصویری برای آپلود انتخاب کنید.", "error"); // ترجمه
                return;
            }
            // ...
            try {
                // ...
                if (!signer) {
                    setMintStatus("اتصال کیف پول مورد نیاز است.", "error"); // ترجمه
                    return;
                }
                // ...
                mintSubmitButton.textContent = "در حال آپلود..."; // ترجمه
                setMintStatus("در حال آپلود اثر هنری به NFT.Storage...", "info"); // ترجمه
                // ...
                if (!result.metadata_cid) {
                    throw new Error("CID فراداده از بک‌اند بازگردانده نشد"); // ترجمه
                }
                // ...
                if (!(priceEth > 0)) {
                    throw new Error("یک قیمت مثبت معتبر وارد کنید"); // ترجمه
                }

                setMintStatus("در حال ضرب NFT در شبکه...", "info"); // ترجمه
                // ...
                setMintStatus("در حال تأیید بازارچه...", "info"); // ترجمه
                // ...
                setMintStatus("در حال لیست کردن آیتم...", "info"); // ترجمه
                // ...
                setMintStatus("NFT با موفقیت ایجاد و برای فروش لیست شد!", "success"); // ترجمه
                // ...
                // ...
            } catch (error) {
                // ...
                setMintStatus(error.message, "error");
            } finally {
                mintSubmitButton.disabled = false;
                mintSubmitButton.textContent = "آپلود و آماده‌سازی فراداده"; // ترجمه
            }
        }
        //... بقیه توابع
    </script>
</body>

</html>